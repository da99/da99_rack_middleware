#!/usr/bin/env bash
# -*- bash -*-
#
#
set -u -e -o pipefail

source bin/env
mkdir -p tmp

# === Stop the current server, if found.
if [[ "$@" == *start* ]]
then

  if [[ -f "$PID" && -s "$PID" ]]
  then
    bin/server stop
  fi

  # === Reset tmp files
  rm -f "$PID"
  rm -f "$LOG"
  echo '' > "$JAR"
  echo "Starting server: PORT: $PORT"
fi

bundle exec thin -d -l $LOG -P $PID -p $PORT -e production -R specs/helpers/config.ru $@

if [[ "$@" == *start* ]]
then
  sleep 0.5
  echo "PID: $(cat $PID)"
fi


